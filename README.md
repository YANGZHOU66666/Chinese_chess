# 221250036杨洲.大一上CPL期末项目.中国象棋

## 1.基本参数

+ 操作系统：Windows系统
+ mingw 版本：gcc version 8.1.0
+ 第三方库：SDL

## 2.棋局操作说明：

+ 为模拟实现联机，需先打开服务器文件server_new.exe，然后**依次**打开client_blue_new.exe和client_red_new.exe；【这里服务器只有两个线程，因此只能服务一组选手（2人）对弈一次】

+ 待双方均进入棋盘界面时方可移动棋子（否则传输不了数据），蓝先红后；
+ 棋子移动方法：点击棋子，棋子变为选中模式，此时棋子被黄色边框包围，棋盘上显示出该棋子可以移动的位置；此时若点击棋子可以移动的位置，则可实现棋子移动；若此时不想移动该棋子，可以再次点击该棋子取消选中。棋子选中时若点击除上述两种情况外的位置，点击无效。
+ 每回合棋子移动完后等待对方移动棋子，对方移动结束后己方方可继续进行上述移动。棋盘右上方显示此时应为哪一方移动
+ 投降功能：点击后己方判输，对方收到“对方已投降”提示
+ 吐槽功能：棋子选中状态时无效，其余任何时刻均可点击相应信息发给对方，对方收到一个显示一秒钟的提示窗口。

P.S.如果双方有输赢（投降或正常吃掉对方的将/帅）服务器会自动关闭。若至少一方未决输赢时退出，服务器不会自动关闭，需要手动关闭。

## 3.额外功能/（自认为）写的比较好的地方

+ 额外功能：

  投降功能、吐槽功能：在客户端建立接收线程，并在任何一个可以点击的位置（实际上每一个瞬间都是SDL_WaitEvent()的状态可以点击，否则图形界面会卡）有点击相应区域的case即发送相应信息给服务器的操作。（投降、三个吐槽分别代码为102，111，112，113，存在message第五位）

  选中后显示棋子可以移动的位置：遍历棋盘，找到合法点后rendercopy、renderpresent

+ 自认为写的比较好的地方：

  防止接收线程阻塞导致图形界面未响应，用roundx区分每一次移动棋子信息的接收。成功接收到对方棋子移动信息（代码101于message第五位）后roundx更新，原本卡在SDL_WaitEventTimeout()位置的主线程（设置这个卡在这里是为了让图形界面有事做，不然会未响应）进入我方移动棋子的部分。
